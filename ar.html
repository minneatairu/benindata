<!DOCTYPE html>
<html>
<head>
    <title>AR Beaded Shirt with Three.js</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar.js"></script>
</head>
<body>
    <script>
        // Initialize the scene
        const scene = new THREE.Scene();
        const camera = new THREE.Camera();
        scene.add(camera);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Initialize AR.js
        const arToolkitSource = new THREEx.ArToolkitSource({ sourceType: 'webcam' });

        arToolkitSource.init(() => {
            setTimeout(() => {
                onResize();
            }, 2000);
        });

        window.addEventListener('resize', onResize);

        function onResize() {
            arToolkitSource.onResize();
            arToolkitSource.copySizeTo(renderer.domElement);
            if (arToolkitContext.arController !== null) {
                arToolkitSource.copySizeTo(arToolkitContext.arController.canvas);
            }
        }

        const arToolkitContext = new THREEx.ArToolkitContext({
            cameraParametersUrl: 'https://raw.githack.com/AR-js-org/AR.js/master/data/data/camera_para.dat',
            detectionMode: 'mono'
        });

        arToolkitContext.init(() => {
            camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
        });

        // Create a marker
        const markerRoot = new THREE.Group();
        scene.add(markerRoot);

        const markerControls = new THREEx.ArMarkerControls(arToolkitContext, markerRoot, {
            type: 'pattern',
            patternUrl: 'https://raw.githack.com/AR-js-org/AR.js/master/data/data/patt.hiro'
        });

        // Create beads to form the shirt
        const beadGeometry = new THREE.SphereGeometry(0.05, 16, 16);
        const beadMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        const numBeadsX = 10;
        const numBeadsY = 15;
        const beadSpacing = 0.12;

        const instancedMesh = new THREE.InstancedMesh(beadGeometry, beadMaterial, numBeadsX * numBeadsY);
        const dummy = new THREE.Object3D();

        for (let i = 0; i < numBeadsX; i++) {
            for (let j = 0; j < numBeadsY; j++) {
                const id = i * numBeadsY + j;
                dummy.position.set(i * beadSpacing - (numBeadsX * beadSpacing) / 2, j * beadSpacing - (numBeadsY * beadSpacing) / 2, 0);
                dummy.updateMatrix();
                instancedMesh.setMatrixAt(id, dummy.matrix);
            }
        }

        markerRoot.add(instancedMesh);

        // Load and insert the commemorative head model
        const loader = new THREE.GLTFLoader();
        loader.load('path/to/your/head_model.glb', (gltf) => {
            const headModel = gltf.scene;
            headModel.position.set(0, 0, 0.5); // Adjust position as needed
            markerRoot.add(headModel);
        });

        // Render loop
        function render() {
            requestAnimationFrame(render);

            if (arToolkitSource.ready) {
                arToolkitContext.update(arToolkitSource.domElement);
            }

            renderer.render(scene, camera);
        }

        render();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/GLTFLoader.js"></script>
</body>
</html>
